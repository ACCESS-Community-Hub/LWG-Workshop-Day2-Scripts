## Purpose

Converts the NetCDF file created by an xconv conversion of the ACCESS-ESM1.5 atmosphere restart file to a gridinfo file useable by CABLE offline.

## Usage

The ACCESS-ESM1.5 restart file, in UM fields format, must first be converted to NetCDF using the process described in the [Conversion Process](#conversion-process) section. After conversion to ```<inputfilename>```, the script can be called via the command line via

```python convert_ACCESS_to_CABLE.py -i <inputfilename> -o <outputfilename> --areafile <areafile>```.

The area file is required as the ACCESS-ESM1.5 restart file does not contain the grid cell areas which are required by CABLE. The files used in the testing of this process are described in the [Conversion Process](#conversion-process).

## Method

### Overview

CABLE is incorporated as part of the atmosphere component, the UM, in the ACCESS-ESM1.5 model. As such, the restart is in the form of a UM fields file, which is not compatible with CABLE offline. The process described here is used to convert the UM fields file to a NetCDF file useable by CABLE offline. The ACCESS-ESM1.5 restart file used is located at

```/g/data/vk83/configurations/inputs/access-esm1p5/modern/pre-industrial/restart/atmosphere/PI-02.astart-01010101```.

Most of the work determining the mapping from the ACCESS-ESM1.5 fields to CABLE gridinfo variables was done by Rachel Law.

### Conversion Process

Select fields from the UM fields file are converted without modification to NetCDF via the [xconv](https://ncas-cms.github.io/xconv-doc/html/index.html) tool. The full list of field numbers converted is:

```3, 11, 27, 28, 29, 30, 32, 33, 90, 95, 98, 142, 143, 144, 157, 182, 183, 184, 230, 231, 232, 233, 234, 235```

These are converted by simpling selecting all these field numbers and pressing ```convert``` in the ```xconv``` GUI. Descriptions of each of these fields is contained in the table below. The generated NetCDF file is then passed as the ```inputfile``` to ```convert_to_CABLE_gridinfo.py``` via

```python convert_to_CABLE_gridinfo.py <inputfile> <outputfile>```.

The generated ```outputfile``` should be usable by CABLE as a gridinfo file.

### Conversion Details

Many of the fields in the ACCESS-ESM1.5 restart file require conversions to be useable as CABLE gridinfo, as well as attaching of metadata for provenance. This table provides a description of the source for each of the variables in the CABLE gridinfo file.

N.B. UM fields without a specified short name are given the "temp" placeholder short name. This is the name applied to the NetCDF variable. NetCDF files do not allow multiple variables with the same name, so subsequent attempts to write to the same variable name will append "_1", "_2" etc to the short name. The order in which the suffixes is the same as the order the fields appear in the UM fields file i.e. in field number order.

| GridInfo Name | UM Field No. | UM Field Title | UM Short Name | Comments |
|:-------------:|:------------:|:--------------:|:-------------:|----------|
| longitude | N/A | N/A | "longitude" | Autogenerated by xconv, mapped from a 0 to 360 degree coordinate system to -180 to 180. |
| latitude | N/A | N/A | "latitude" | Autogenerated by xconv |
| area | N/A | N/A | "areacella" | Taken from ```/g/data/fs38/publications/CMIP6/CMIP/CSIRO/ACCESS-ESM1-5/piControl/r1i1p1f1/fx/areacella/gn/v20210316/areacella_fx_ACCESS-ESM1-5_piControl_r1i1p1f1_gn.nc```. The "areacella" is taken as is including metadata, with the variable name changed to "area". |
| iveg | 95 | FRACTIONS OF SURFACE TYPES | field1391 | UM provides respective fractions of each vegetation type in a lon x lat x nvegtypes array. Take the dominant vegetation type for the CABLE gridinfo. Given units of 1. |
| patchfrac | 157 | Land fraction in grid box | lsm | Set to 1.0 for all land cells. Given units of 1. UM field is used to acquire the landmask. |
| isoil | N/A | N/A | N/A | Set to 2 for all vegetation types bar 17, which is set to 9. |
| SoilMoist | 3 | SOIL MOISTURE CONTENT IN A LAYER | sm | Convert from kg/m<sup>3</sup> to m<sup>3</sup>/m<sup>3</sup>, by dividing by layer thickness and density of water. CABLE needs monthly values, so copy values across length 12 time axis. |
| SoilTemp | 11 | DEEP SOIL TEMP AFTER TIMESTEP | soiltemp | CABLE needs monthly values, so copy values across length 12 time axis. |
| SnowDepth | 182,183,184 | Stash code = (819,820,821) | temp, temp{_1}, temp{_2} | Snow depth is provided in each layer per PFT. Total snow depth is computed via taking the snow depth for each respective PFT and scaling by the PFT fraction. Given units of m. |
| Albedo | N/A | N/A | N/A | Set to 0.2. Not used but bounds checked (?). |
| LAI | 235 | Stash code = 893 | temp{_8} | Fields file contains LAI for each PFT on each grid cell. Set the LAI for the grid cell based off the dominant vegetation type determined from iveg. CABLE needs monthly values, so copy values across length 12 time axis. Given units of 1. |
| SoilOrder | 230 | Stash code = 883 | temp{_3}\* | Convert from floating point values to integer. Given units of 1. |
| Ndep | 231 | Stash code = 884 | temp{_4} | Convert from g/m<sup>2</sup>/day to g/m<sup>2</sup>/year by multiplying by 365, and supplied with units metadata. Given long name "annual Nitrogen deposition rate". |
| Nfix | 232 | Stash code = 885 | temp{_5} | Appears to already by in g/m<sup>2</sup>/year. Given appropriate units and long name "annual Nitrogen fixation rate". |
| Pwea | 234 | Stash code = 888 | temp{_7} | Given units of g/m<sup>2</sup>/year and long name "annual yield of Phosphorous from weathering". |
| Pdust | 233 | Stash code = 887 | temp{_6} | Given units of g/m<sup>2</sup>/year and long name "annual yield of Phosphorous from dust deposition". |
| clay | 142 | Dust parent soil clay fraction (anc) | field1630 | Given units of 1 and long name "UM soil texture - clay fraction". |
| silt | 143 | Dust parent soil silt fraction (anc) | field1631 | Given units of 1 and long name "UM soil texture - silt fraction". |
| sand | 144 | Dust parent soil sand fraction (anc) | field1632 | Given units of 1 and long name "UM soil texture - sand fraction". |
| swilt | 27 | VOL SMC AT WILTING AFTER TIMESTEP | field329 | Given units of 1. |
| sfc | 28 | VOL SMC AT CRIT PT AFTER TIMESTEP | field330 | Given units of 1. |
| ssat | 29 | VOL SMC AT SATURATION AFTER TIMESTEP | field332 | Given units of 1. |
| bch | 90 | CLAPP-HORNBERGER "B" COEFFICIENT | field1381 | Given units of 1. |
| hyds | 30 | SAT SOIL CONDUCTIVITY AFTER TIMESTEP | field333 | Divide by 1000 to go from kg/m<sup>2</sup>/s to m/s, and given appropriate units. |
| sucs | 33 | SATURATED SOIL WATER SUCTION      ** | field342 | |
| rhosoil | N/A | N/A | N/A | Set according to isoil. 1600.0 where isoil=2, 910.0 where isoil=9. Given units of kg/m<sup>3</sup>. |
| cnsd | 32 | THERMAL CONDUCTIVITY AFTER TIMESTEP | field336 | |
| css | N/A | N/A | N/A | Set according to isoil. 850.0 where isoil=2, 2100.0 where isoil=9. Given units of J/kg/K. |
| albedo2 | 98 | SNOW-FREE ALBEDO OF SOIL | field1395 | Given units of 1. |
